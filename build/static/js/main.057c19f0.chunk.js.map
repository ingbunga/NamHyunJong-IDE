{"version":3,"sources":["nhj/src/core.js","nhj/src/parse.js","nhj/src/tokenizer.js","App.js","index.js"],"names":["_Symbol","name","this","Env","params","args","outer","scope","reduce","acc","e","i","undefined","find","SyntaxError","Procedure","bodys","env","createdFunc","createdEnv","arguments","_","_eval","toString","map","Macro","createdMacro","isMacro","Quoted","body","schemestr","unQuote","x","isSymbol","s","isString","String","isNumber","n","Number","isValue","Array","global_env","op","test","conseq","alt","exp","symbol","slice","Function","bind","proc","execArgs","arg","join","globalThis","window","js_env","math_env","Math","xs","length","xs1","xs2","concat","f","x1","x2","JSON","stringify","pow","max","min","console","log","round","standard_env","read_from_token","tokens","parsed","parse_one","token","shift","sub_tkn","push","ftoken","parseFloat","isNaN","isStingAtom","atom","parse","program","chars","clearAcc","saveAcc","shouldBeEmptyAcc","inner_str","before","cur","tokenize","App","useState","code","setCode","output","setOutput","AddToOutput","text","o","print","width","height","language","theme","value","options","selectOnLineNumbers","onChange","newValue","onClick","replace","forEach","error","id","style","background","color","fontFamily","overflowY","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.057c19f0.chunk.js","sourcesContent":["\nexport class _Symbol {\n    constructor(name) {\n        this.name = name;\n    }\n    toString(){\n        return this.name;\n    }\n}\n\nexport class Env {\n    constructor(params = [], args = [], outer = null) {\n        this.scope = {\n            ...this.scope,\n            ...params.reduce((acc, e, i) => ({ ...acc, [e.name]: args[i] }), {}),\n        };\n        this.outer = outer;\n    }\n\n    find(name) {\n        if (this.scope[name] !== undefined)\n            return this.scope;\n        if (!this.outer)\n            throw SyntaxError(`cannot find symbol ${name}`);\n        else\n            return this.outer.find(name);\n    }\n}\n\n\nfunction Procedure(params, bodys, env) {\n\n    const createdFunc = function (...args) {\n        const createdEnv = new Env(params, args, env);\n        createdEnv.scope.arguments = arguments;\n\n        return bodys.reduce((_, e) => _eval(e, createdEnv), undefined);\n    };\n    createdFunc.toString = () => (\n        `[Procedure (${params.map(e => e?.name)})]`\n    );\n\n    return createdFunc;\n}\n\n\nfunction Macro(params, bodys, env) {\n\n    const createdMacro = function (...args) {\n        const createdEnv = new Env(params, args, env);\n        createdEnv.scope.arguments = arguments;\n\n        return bodys.reduce((_, e) => _eval(e, createdEnv), undefined);\n    }\n    createdMacro.toString = () => (\n        `[Macro (${params.map(e => e?.name)})]`\n    );\n    createdMacro.isMacro = true;\n    \n    return createdMacro;\n}\n\n\nclass Quoted {\n    constructor(body) {\n        this.body = body;\n    }\n    toString() {\n        return schemestr(this.body);\n    }\n}\n\nfunction unQuote(x) {\n    return (x instanceof Quoted)\n           ? x.body\n           : x;\n}\n\n\nfunction isSymbol(s) {\n    return s instanceof _Symbol;\n}\n\nfunction isString(s) {\n    return typeof (s) === 'string' || s instanceof String;\n}\n\nfunction isNumber(n) {\n    return typeof (n) === 'number' || n instanceof Number;\n}\n\n/**\n * value means not AST\n * likes Number, String, Quoted...\n */\nfunction isValue(x) {\n    // Array means AST.\n    return (!(x instanceof Array));\n}\n\n\nfunction standard_env() {\n    const env = new Env();\n    env.scope = {\n        '+'         : (...xs) => xs.reduce((acc, e) => acc + e),\n        '-'         : (...xs) => xs.length === 1\n                                 ? -xs[0]\n                                 :xs.reduce((acc, e) => acc - e),\n        '*'         : (...xs) => xs.reduce((acc, e) => acc * e),\n        '/'         : (...xs) => xs.reduce((acc, e) => acc / e),\n        '>'         : (...xs) => xs.slice(1).reduce((acc, e, i) => acc && xs[i] > e, true),\n        '<'         : (...xs) => xs.slice(1).reduce((acc, e, i) => acc && xs[i] < e, true),\n        '>='        : (...xs) => xs.slice(1).reduce((acc, e, i) => acc && xs[i] >= e, true),\n        '<='        : (...xs) => xs.slice(1).reduce((acc, e, i) => acc && xs[i] <= e, true),\n        '='         : (...xs) => xs.slice(1).reduce((acc, e, i) => acc && xs[i] == e, true),\n        'append'    : (xs1, xs2) => xs1.concat(xs2),\n        'apply'     : (xs, f) => f(...xs),\n        'begin'     : (...args) => args.slice(-1)[0],\n        'car'       : xs => xs[0],\n        'cdr'       : xs => xs.slice(1),\n        'cons'      : (x, xs) => [x].concat(xs),\n        'eq?'       : (x1, x2) => JSON.stringify(x1) === JSON.stringify(x2),\n        'expt'      : Math.pow,\n        'equal?'    : (x1, x2) => x1 === x2,\n        'length'    : xs => xs.length,\n        'list'      : (...args) => args,\n        'list?'     : x => x instanceof Array,\n        'map'       : (f, xs) => xs.map(f),\n        'max'       : (...args) => args.length === 1\n                                   ? Math.max(...args[0])\n                                   : Math.max(...args),\n        'min'       : (...args) => args.length === 1\n                                   ? Math.min(...args[0])\n                                   : Math.min(...args),\n        'not'       : x => !x,\n        'null'      : x => x instanceof Array ? x.length < 1 : false,\n        'number?'   : isNumber,\n        'print'     : console.log,\n        'produre?'  : x => x instanceof Function,\n        'round'     : Math.round,\n        'symbol?'   : isSymbol,\n        'string?'   : isString,\n        'Math'      : Math,\n        'new'       : arg => new arg,\n        'eval'      : x => _eval(unQuote(x)),\n    };\n    return env;\n}\n\n\nexport function _eval(x, env = global_env) {\n    if (isSymbol(x))\n        return env.find(x.name)[x.name];\n    if (isValue(x)) // Quoted, Number, String, ...\n        return x;\n    const [op, ...args] = x;\n    switch (op?.name) {\n        case 'quote':\n            return new Quoted(args[0]);\n        case 'if':\n            var [test, conseq, alt] = args;\n            var exp = _eval(test, env) ? conseq : alt;\n            return _eval(exp, env);\n        case 'define':\n            var [symbol, exp] = args;\n            env.scope[symbol.name] = _eval(exp, env);\n            return env.scope[symbol.name];\n        case 'set!':\n            var [symbol, exp] = args;\n            env.find(symbol.name)[symbol.name] = _eval(exp, env);\n            break;\n        case 'lambda':\n            var [params, ...bodys] = args;\n            return Procedure(params, bodys, env);\n        case 'macro':\n            var [params, ...bodys] = args;\n            return Macro(params, bodys, env);\n        case '.':\n            return args.slice(1)\n                       .reduce((acc, e) => (\n                           acc[e.name] instanceof Function\n                           ? acc[e.name].bind(acc)\n                           : acc[e.name]\n                        ), _eval(args[0], env));\n        default:\n            var proc = _eval(x[0], env);\n            if (proc?.isMacro) {\n                const execArgs = args.map(arg => new Quoted(arg));\n                return _eval(unQuote(proc(...execArgs)));\n            }\n            else {\n                const execArgs = args.map(arg => _eval(arg, env));\n                return proc(...execArgs);\n            }\n    }\n}\n\n\nexport function schemestr(exp) {\n    if (isString(exp))\n        return `\"${exp}\"`\n    if (exp instanceof Array)\n        return '(' + exp.map(schemestr).join(' ') + ')'\n    else\n        return String(exp)\n}\n\n\nconst globalThis = window; // quick fix\n\nconst js_env = new Env();\njs_env.scope = globalThis;\nconst math_env = new Env();\nmath_env.scope = Math;\nmath_env.outer = js_env;\nexport const global_env = standard_env();\nglobal_env.outer = math_env;","import { _Symbol } from './core.js';\nimport { tokenize } from './tokenizer.js';\n\n\nexport function read_from_token(tokens) {\n    const parsed = [];\n    \n    function parse_one() {\n        const token = tokens.shift();\n    \n        switch(token) {\n            case undefined:\n                throw SyntaxError(\"uncomplete input\");\n            case '(':\n                const sub_tkn = []\n                while (tokens[0] !== ')')\n                    sub_tkn.push(parse_one(tokens))\n                tokens.shift(); // remove ')'\n                return sub_tkn;\n            \n            case ')':\n                throw SyntaxError('unexpected )');\n                \n            default:\n                return atom(token);\n                \n        }\n    }\n\n    while (tokens.length > 0) {\n        parsed.push(parse_one());\n    }\n\n    return parsed;\n}\n\n\nfunction isStingAtom(token) {\n    return (\n        token.length >= 2 &&\n        token[0] == '\"' &&\n        token[token.length-1] == '\"'\n    )\n}\n\nexport function atom(token) {\n    const ftoken = parseFloat(token);\n    if(!isNaN(ftoken))\n        return ftoken\n    if(isStingAtom(token))\n        return String(token.slice(1, -1))\n    else\n        return new _Symbol(token)\n}\n\n\nexport function parse(program) {\n    return read_from_token(tokenize(program))\n}\n\n\n","\nexport function tokenize(chars) {\n    const tokens = [];\n\n    let acc = '';\n\n    function clearAcc() {\n        acc = '';\n    }\n\n    function saveAcc() {\n        if(acc !== '') {\n            tokens.push(acc)\n        }\n    }\n\n    function shouldBeEmptyAcc(errorMessage = \"no space\") {\n        if(acc !== '') {\n            throw SyntaxError(errorMessage)\n        }\n    }\n\n    for(let i = 0; i < chars.length; i++) {\n        const e = chars[i];\n\n        switch (e) {\n            case '(':   // list\n                saveAcc();\n                tokens.push(e);\n                clearAcc();\n                break;\n\n            case ')':\n                saveAcc();\n                tokens.push(e);\n                clearAcc();\n                break;\n\n            case '\"':   // string\n                shouldBeEmptyAcc('nospace' + acc);\n                \n                let inner_str = '\"';\n                \n                for(i += 1; i < chars.length; i++) {\n                    const before = chars[i-1];\n                    const cur = chars[i];\n                    \n                    inner_str += cur;\n\n                    if(cur === '\"' && before !== '\\\\')\n                        break;\n                }\n\n                tokens.push(inner_str);\n                break;\n\n            case ';':   // comment\n                saveAcc();\n                clearAcc();\n                \n                for(i += 1; i < chars.length; i++)\n                    if(chars[i] === '\\n')\n                        break;\n                \n                break;\n            \n            case '\\n':  // change line\n            case ' ':   // space\n                saveAcc();\n                clearAcc();\n                break;\n\n            default:\n                acc += e;\n        }\n    }\n\n    saveAcc();\n\n    return tokens;\n    \n}\n","import React, { useEffect, useState } from 'react';\nimport { render } from 'react-dom';\nimport MonacoEditor, { monaco } from 'react-monaco-editor';\nimport { global_env, _eval, schemestr } from './nhj/src/core';\nimport { parse } from './nhj/src/parse.js';\n\n\nfunction App() {\n  const [code, setCode] = useState('; type your code...');\n  const [output, setOutput] = useState([]);\n\n  global_env.scope.print = (...args) => {\n    AddToOutput(args.map(String).join(' '));\n  }\n\n  function AddToOutput(text) {\n    setOutput(o => [...o, text]);\n  }\n\n\n  function onChange(newValue, e) {\n    setCode(newValue);\n  }\n\n  function onExec() {\n    setOutput('');\n    try {\n      parse(code.replace(/\\r\\n/gi, '\\n')).forEach(e => _eval(e));\n    }\n    catch (e) {\n      AddToOutput(e);\n      console.error(e);\n    }\n  }\n\n  return (\n    <div>\n      <MonacoEditor\n        width=\"800\"\n        height=\"600\"\n        language=\"clojure\"\n        theme=\"vs-dark\"\n        value={code}\n        options={{\n          selectOnLineNumbers: true,\n        }}\n        onChange={onChange}\n      />\n      <div>\n        <button onClick={onExec}>exec</button>\n      </div>\n      <div id=\"output\" style={{\n        background: 'rgb(29, 29, 29)',\n        color: 'white',\n        width: '800px',\n        height: '100px',\n        fontFamily: 'monospace',\n        overflowY: 'auto',\n      }}>\n        {output.map(e => (\n          <div>{e}</div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n\n"],"sourceRoot":""}